var oData = {};var activeClass = 'riskCheck';var myScroll;initialize();// 初始化function initialize() {	oTools.ReadToLocal(function (data) {		oData = $.extend(oData, data);				qryEligPaper(function(binData) {			//binData.resultList;			oData.TESTBIRTH = oData.IDNUMBER.substring(6,10)+"-"+oData.IDNUMBER.substring(10,12)+"-"+oData.IDNUMBER.substring(12,14);			var nRiskAge=parseInt(getDays(oData.TESTBIRTH)/365);			var oFirAnswer=[],				nLenResult,				oAnswerList,				i=0;			binData.resultList[0].default_answer = '1';			oAnswerList=binData.resultList[0].answer_content;			for(var prop in oAnswerList){				oFirAnswer[i]=oAnswerList[prop].substring(0,2);				i++;			}			for(var j=oFirAnswer.length-1;j>0;j--){				if(nRiskAge >= oFirAnswer[j]){					binData.resultList[0].default_answer = j+1;					break;				}			}			var professionNo = oData.PROFESSIONNO || '02';			switch(professionNo) {				case '02':				binData.resultList[1].default_answer = 1;				break;				case '03': case '04':				binData.resultList[1].default_answer = 2;				break;				case '05':				binData.resultList[1].default_answer = 3;				break;				case '06':				binData.resultList[1].default_answer = 4;				break;				case '09':				binData.resultList[1].default_answer = 5;				break;				case '10':				binData.resultList[1].default_answer = 6;				break;				case '07':				binData.resultList[1].default_answer = 7;				break;				case '01': case '08': case '99':				binData.resultList[1].default_answer = 8;				break;			}			fillEligPaper(document.getElementById('scroller'), binData.resultList);			// 模拟表单控件input(checkbox和radio)			$('#riskWraper .itemRisk').each(function(index){				var $riskIco = $(this).find('.listCheck');					//iIndex = $(this).attr('default_answer').split('^');				if (index == 0 || index == 1) {					iIndex = $(this).attr('default_answer');					$riskIco.eq(iIndex-1).find('.riskIco').addClass(activeClass);				} else {					iIndex = '';				}				//for (var j = 0; j < iIndex.length; j++) {				//	console.log(iIndex[j]-1);					// $riskIco.eq(iIndex[j]-1).find('.riskIco').addClass(activeClass);				//}								if ($(this).attr('question_kind') === '1') {					ckbox($riskIco, '.riskIco', activeClass);				} else {					simRadio($riskIco, '.riskIco', iIndex[0]-1);				}			});			calculateHeight("riskWraper", 125);			loaded();		});	}, "clientId=&IdNumber=&professionNo=");	document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);};function loaded() {	var bBtn = true;	if(app.indexOf("iphone")>0 || app.indexOf("android 2.3")>0){		 bBtn = false;	 }else if(app.indexOf("android")>0){		 bBtn = true;	 }	myScroll = new iScroll('riskWraper', {		hScroll: false,		bounce: false,		hScrollbar: false,		onBeforeScrollStart: false,		handleClick: bBtn,		useTransform: false,		useTransition: false	});};// 下一步$('.btnContinue').bind('click', function() {	var paper_answer = getEligSurvey();		if (paper_answer.state) {		var str = '';		for (var i = 0; i < paper_answer.result.length; i++) {			str += '第' + paper_answer.result[i] + '题、';		}		    if(str.slice(-1) ==  '、' ){ str = str.slice(0,-1);}        alert('您的答题尚未完成，' + str + '未作答。');	} else {		setEligSurvey(paper_answer.result, function(binData) {			oTools.SaveToLocal({				corpRiskLevel: binData.corp_risk_level			}, function() {				onJsOverrideUrlLoading('/sjkh/pcresult.htm');			});		});	}});// 客户风险测评试卷查询function qryEligPaper(succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0027");	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData);		} else {	        alert(error_info);		}	});};// 客户风险测评试卷填充function fillEligPaper(obj, arr) {	var i = 0,		len = arr.length,		str = '';		for (; i < len; i++) {		if (i == 0 || i == 1) {			str += '<ul class="itemRisk" style="display:none;" default_answer="' + arr[i].default_answer + '" question_kind="' + arr[i].question_kind + '" question_no="' + arr[i].question_no + '"><li class="listTitle">' + (i+1) + '.' + arr[i].question_content + '(单选)</li>';		} else {			if (arr[i].question_kind == '1') {				str += '<ul class="itemRisk" default_answer="' + arr[i].default_answer + '" question_kind="' + arr[i].question_kind + '" question_no="' + arr[i].question_no + '"><li class="listTitle">' + (i-1) + '.' + arr[i].question_content + '(多选)</li>';			} else {				str += '<ul class="itemRisk" default_answer="' + arr[i].default_answer + '" question_kind="' + arr[i].question_kind + '" question_no="' + arr[i].question_no + '"><li class="listTitle">' + (i-1) + '.' + arr[i].question_content + '(单选)</li>';			}		}		var j = 1;		for (var attr in arr[i].answer_content) {			var key;			switch(j){				case 1:				key = 'A';				break;				case 2:				key = 'B';				break;				case 3:				key = 'C';				break;				case 4:				key = 'D';				break;				case 5:				key = 'E';				break;				case 6:				key = 'F';				break;				case 7:				key = 'G';				break;				case 8:				key = 'H';				break;				case 9:				key = 'I';				break;				case 10:				key = 'J';				break;			}			if (arr[i].question_kind == '1') { // 多选				str += '<li class="listCheck"><a class="linkRisk">' + key + '、' + arr[i].answer_content[attr] + '</a><b class="riskIco"></b></li>';			} else { // 单选				str += '<li class="listCheck"><a class="linkRisk">' + key + '、' + arr[i].answer_content[attr] + '</a><b class="riskIco riskIcoCirl"></b></li>';			}			j++;		}				str += '</ul>';	}		obj.innerHTML = str;};// 获取答案function getEligSurvey() {	var re = /\^$/,		resultStr = '',		resultArr = [];	$('#riskWraper .itemRisk').each(function(index){		var $riskIco = $(this).find('.riskIco'),			str = $(this).attr('question_no') + '&',			bBtn = true;		$riskIco.each(function(m) {			if ($(this).hasClass(activeClass)) {				bBtn = false;				str += (m+1) + '^';			}		});		if (bBtn) { resultArr.push(index-1); }		var str2 = str.replace(re, '|');		resultStr += str2;	});	return {		result: resultArr.length > 0 ? resultArr : resultStr,		state: resultArr.length > 0 ? true : false	};};// 客户风险答卷提交function setEligSurvey(paper_answer, succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0028&op_station=($tztudid)&branch_no=" + branchNo + "&client_id=" + oData.CLIENTID + "&paper_answer=") + encodeURIComponent(paper_answer);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData);		} else {			alert(error_info);		}	});};// 客户身份检查(验证是否是满18岁)function getDays(sDateBegin,sDateEnd){	var sDateBegin = sDateBegin,			sDateEnd = sDateEnd,			dToday = new Date();	if(sDateEnd == null){ 		sDateEnd = String(dToday.getFullYear()) 			 + '-' + (dToday.getMonth() +1 < 10 ? ('0' + String(dToday.getMonth()+1)) :String(dToday.getMonth() +1))			 + '-' + String(dToday.getDate())	}   var  aMesg,  oDateBegin,  oDateEnd,  DAYS = 0;     aMesg  =  sDateBegin.split("-") ;   oDateBegin  =  new  Date(aMesg[1]  +  '-'  +  aMesg[2]  +  '-'  +  aMesg[0])   //转换为12-18-2006格式     aMesg  =  sDateEnd.split("-")  ;   oDateEnd  =  new  Date(aMesg[1]  +  '-'  +  aMesg[2]  +  '-'  +  aMesg[0])     DAYS  =  parseInt(Math.abs(oDateBegin  -  oDateEnd)  /  1000  /  60  /  60  /24)    //把相差的毫秒数转换为天数     return  DAYS;}