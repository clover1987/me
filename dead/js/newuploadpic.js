var oData = {};oData.iNum = 0; // 身份证识别错误次数initialize();// 初始化function initialize() {	// 模拟checkbox	ckboxPic('.boxpicFoot', '#picCheck', 'picCheckNone');	// 身份证照片	switch(parseInt(getUrlParameter("type"))){		case 1: // 正		oTools.SaveToLocal({			zIdPic: "1"		}, loadPic);		break;		case 2: // 反		oTools.SaveToLocal({			fIdPic: "1"		}, loadPic);		break;		default:		loadPic();		break;	}};function ckboxPic(id, sClass, activeClass){	$(id).bind('click', function(){		var that = $(this).find(sClass),			selected = that.hasClass(activeClass);		if(selected){ //已选中			that.removeClass(activeClass);			oTools.SaveToLocal({				isChecked: "true"			});		}else{ //未选中			that.addClass(activeClass);			oTools.SaveToLocal({				isChecked: "false"			});		}	});};function loadPic() {	oTools.ReadToLocal(function (data) {		oData = $.extend(oData, data);		if (data.ZIDPIC == "1") {			$('.newboxFace').html('<img src="/reqloadfile?path=/sjkh/img/zpic.jpg" alt="" />');			if (data.ISCHECKED == 'true') {				$('#picCheck').removeClass('picCheckNone');			}		}		if (data.FIDPIC == "1") {			$('.newboxBack').html('<img src="/reqloadfile?path=/sjkh/img/fpic.jpg" alt="" />');			if (data.ISCHECKED == 'true') {				$('#picCheck').removeClass('picCheckNone');			}		}	}, "zIdPic=&fIdPic=&IdNumber=&MobileNo=&clientId=&clientName=&isChecked=");};// 拍摄身份证正面照$('.newboxFace').click(function() {	onJsOverrideUrlLoading("http://action:10051?url=/sjkh/newuploadpic.htm?type=1&val=sjkh/img/zpic.jpg.d");});// 拍摄身份证反面照$('.newboxBack').click(function() {	onJsOverrideUrlLoading("http://action:10051?url=/sjkh/newuploadpic.htm?type=2&val=sjkh/img/fpic.jpg.d");});// 查看协议内容var oShow = $('.show_warp'),	aHeight = $(document).height();$('.textCheckLink').click(function(){	getEcontractConfig(function(resultList){		getEcontractTextConfig(resultList[0].econtract_id, function(binData){			oShow.css({width: '100%', height: aHeight}).show();			document.body.scrollTop = 0;			$('.box').css({width: '100%'}).html('<h2>'+binData.econtract_name+'</h2>'+ '<p>' + binData.econtract_content + '</p>');		});	});});var iHeight = $(window).height()-272;if (iHeight > $("#wrapped ul").height()) {	iHeight = 330;}$("#wrapped").height(iHeight);$('#closed').click(function(){	oShow.hide();});oData.bBtn = false;// 继续开户$('.btnContinue').bind('click', nextFun);function nextFun() {	//if(oData.bBtn){	//	alert('正在上传照片，请稍候');	//	return;	//}	if ($('#picCheck').hasClass('picCheckNone')) {        alert('请先勾选我已仔细阅读并同意签署《个人数字证书申请责任书》');		return;	}		if (oData.ZIDPIC != "1" || oData.FIDPIC != "1") {         alert('您尚未完成身份证照片上传任务，请先上传身份证照片');		return; 	}		//oData.bBtn = true;	onJsOverrideUrlLoading('http://action:10049?show=1&&text=上传正面照中...');	getIdentifyBase64('WA0012', '6A', 'image_data|sjkh/img/zpic.jpg.d', function(binData) {		oTools.SaveToLocal({			idAddress: binData.id_address,			clientGender: binData.client_gender,			birthday: binData.birthday,			picIdNumber: binData.id_no,			clientId: binData.client_id,			clientName: binData.client_name,			postCode: binData.zipcode		}, fCard);	}, function(data) {		error(data, '6A');	});	function fCard() {		onJsOverrideUrlLoading('http://action:10049?show=1&&text=上传反面照片中...');		getIdentifyBase64('WA0012', '6B', 'image_data|sjkh/img/fpic.jpg.d', function(binData) {			oTools.SaveToLocal({				idBeginDate: binData.id_begindate,				idEndDate: binData.id_enddate,				issuedDepart: binData.issued_depart					}, function() {				onJsOverrideUrlLoading('http://action:10049?show=0');				//window.location.href = 'wszl.htm?type=1';				onJsOverrideUrlLoading('/sjkh/wszl.htm?type=1');			});		}, function(data){			error(data, '6B');		});	};};// 错误处理function error(data, zf) {	var error_no = data.error_no,		error_info = data.error_info,		zfStr = '';	onJsOverrideUrlLoading('http://action:10049?show=0');		if (zf === '6A') {		zfStr = '【正面】';	} else {		zfStr = '【反面】';	}	if (error_no == '-1018') {        alert('上传档案图片类型错误');	} else if (error_no == '-1019') {        oData.iNum += 1;		if (oData.iNum >= 2) {			// alert('亲，宝宝擦红眼睛也没看清您的照片，您可跳过该张图片，上传其他照片后点击继续开户');			// $('.btnContinue').unbind();			// $('.btnContinue').bind('click', function() {			// 	onJsOverrideUrlLoading('/sjkh/wszl.htm?type=2');			// });			// if (confirm('亲，宝宝擦红眼睛也没看清您的照片，您可选【确认】继续开户，选【取消】重新拍摄照片。')) {			// 	onJsOverrideUrlLoading('/sjkh/wszl.htm?type=1');			// } else {			// 	$('.btnContinue').unbind();			// 	$('.btnContinue').bind('click', nextFun);			// }			alert('亲，宝宝睁大了双眼，却依然看不清您上传的身份证' + zfStr + '照片，建议您使用更高分辨率的设备拍摄');		} else {			alert('亲，宝宝看不清您上传的身份证' + zfStr + '照片，请您重新拍摄，注意拍摄的角度和光线哦');		}	} else {        oData.iNum += 1;		if (oData.iNum >= 2) {			// alert('亲，宝宝擦红眼睛也没看清您的照片，您可跳过该张图片，上传其他照片后点击继续开户');			// $('.btnContinue').unbind();			// $('.btnContinue').bind('click', function() {			// 	onJsOverrideUrlLoading('/sjkh/wszl.htm?type=2');			// });			// if (confirm('亲，宝宝擦红眼睛也没看清您的照片，您可选【确认】继续开户，选【取消】重新拍摄照片。')) {			// 	onJsOverrideUrlLoading('/sjkh/wszl.htm?type=1');			// } else {			// 	$('.btnContinue').unbind();			// 	$('.btnContinue').bind('click', nextFun);			// }			alert('亲，宝宝睁大了双眼，却依然看不清您上传的身份证' + zfStr + '照片，建议您使用更高分辨率的设备拍摄');		} else {			alert('亲，宝宝看不清您上传的身份证' + zfStr + '照片，请您重新拍摄，注意拍摄的角度和光线哦');		}	}};// 上传照片function getIdentifyBase64(sInterface, image_no, tztfiledata, succ, error) {	var params = cRequestSign + encodeURI("?action=31001&path=/" + sInterface +"&op_station=($tztudid)&branch_no=10&mobile_tel=" + oData.MOBILENO + "&image_no=" + image_no + "&tztfiledata=" + tztfiledata);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {				if(image_no == '6A'){ //正面识别判断id_no						if(binData.id_no == ''){							error(binData);						}else{							succ(binData);						}								}else{ //反面识别判断						if(binData.id_begindate == ''){							error(binData);						}else{							succ(binData);						}										}							} else {			error(binData);		}	});};// 协议配置列表获取function getEcontractConfig(succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0008&op_station=($tztudid)&econtract_type=2");	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData.resultList);		} else {	        alert(error_info);		}	});};// 协议配置文本获取function getEcontractTextConfig(eId, succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0009&op_station=($tztudid)&econtract_id=" + eId);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData);		} else {	        alert(error_info);		}	});};