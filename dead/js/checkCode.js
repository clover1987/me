var oData = {};initialize();// 初始化function initialize() {	khPhone({		phone: $("#sjyzWraper input").eq(0),		code: $("#capBtn"),		activeClass: "clickCapGray",		time: 60,		callback: function (func, fail) {			sendMobileCode(func, fail);		}	});	if (getUrlParameter("type") === '1') {		oData.csdcOpenFlag = '0';	} else {		oData.csdcOpenFlag = '1';	}};// 继续开户$('.btnNext').bind('click', clickBtn);function clickBtn() {	var re = /^1[3|4|5|8|6]\d{9}$/,		codeRe = /^\d{6}$/;	if (!$('.inputNum').eq(0).val() || !re.test($('.inputNum').eq(0).val())) { 		alert('您输入的手机号码有误，请重新输入');		return;	}	if (!codeRe.test($('.inputNum').eq(1).val())) {		alert('您尚未通过手机号码验证，请先提交6位数字验证码');		return;	}	qryRegisterInfo(function(binData, mobile_tel) {		oData.IDNUMBER = binData.id_no || '';		oData.MOBILENO = mobile_tel;		oData.CLIENTID = binData.client_id || '';		oData.CLIENTNAME = binData.client_name || '';		oData.PROFESSIONCODE = binData.profession_code || '';				if (oData.CLIENTID) {			qryClientInfo(function(binData) {				oData.FUNDACCOUNT = binData.fund_account || '';								oTools.SaveToLocal({					IdNumber: oData.IDNUMBER,					MobileNo: oData.MOBILENO,					clientId: oData.CLIENTID,					clientName: oData.CLIENTNAME,					csdcOpenFlag: oData.csdcOpenFlag,					fundAccount: oData.FUNDACCOUNT,					accountState: 'false',					professionNo: oData.PROFESSIONCODE				}, function() {					nextFunc(binData);				});			});		} else {			oTools.SaveToLocal({				IdNumber: oData.IDNUMBER,				MobileNo: oData.MOBILENO,				clientId: oData.CLIENTID,				clientName: oData.CLIENTNAME,				csdcOpenFlag: oData.csdcOpenFlag,				accountState: 'false',				professionNo: oData.PROFESSIONCODE			}, function() {				nextFunc(binData);			});		}	}, function() {		alert('您尚未通过手机号码验证，请先提交验证码');	})};// 继续开户事件函数function nextFunc(data) {	qryOpenStatus(data.client_id, function(binData) {		var open_status = binData.open_status.split('');							if (open_status[0] == 0) {			if (oData.csdcOpenFlag === '0') {				//window.location.href = 'newuploadpic.htm';				onJsOverrideUrlLoading('/sjkh/newuploadpic.htm');			} else {				//window.location.href = 'uploadpic.htm';				onJsOverrideUrlLoading('/sjkh/uploadpic.htm');			}		//} else if (open_status[1] == 0) {		//	onJsOverrideUrlLoading('/sjkh/wszl.htm');		} else if (open_status[2] == 0 && oData.csdcOpenFlag == '0') {			// 跳转视频见证			onJsOverrideUrlLoading('http://action:10050?urlfalse=/sjkh/fail.htm?state=3&&urltrue=/sjkh/setpwd.htm&&cardId=' + oData.IDNUMBER + '&&mobileNo=' + oData.MOBILENO + '&&branchNo=' + branchNo + '&&clientId=' + oData.CLIENTID + '&&clientName=' + oData.CLIENTNAME);		} else if ((open_status[2] == 2 && oData.csdcOpenFlag == '0') || oData.csdcOpenFlag == '1') {			if (open_status[3] == 0 || open_status[4] == 0) { //需要数字签名						if (oData.csdcOpenFlag === '0') {							onJsOverrideUrlLoading('http://action:10053?urlfalse=/sjkh/setpwd.htm&&urltrue=/sjkh/ktzh.htm&&cardId=' + oData.IDNUMBER + '&&clientId=' + oData.CLIENTID + '&&clientName=' + oData.CLIENTNAME + '&&MobileNo=' + oData.MOBILENO + '&&tztcerttype=0&&digitalPwd=123456');						  //onJsOverrideUrlLoading('/sjkh/setpwd.htm'); 						} else {							onJsOverrideUrlLoading('http://action:10053?urlfalse=/sjkh/digital.htm&&urltrue=/sjkh/ktzh.htm&&cardId=' + oData.IDNUMBER + '&&clientId=' + oData.CLIENTID + '&&clientName=' + oData.CLIENTNAME + '&&MobileNo=' + oData.MOBILENO + '&&tztcerttype=1&&digitalPwd=123456');						}			} else if (open_status[9] == 0) {				onJsOverrideUrlLoading('/sjkh/setallpwd.htm');			} else if (open_status[5] == 0) { //需要数字签名				  //onJsOverrideUrlLoading('/sjkh/depository.htm');					if (oData.csdcOpenFlag === '0') {						onJsOverrideUrlLoading('http://action:10053?urlfalse=/sjkh/setpwd.htm&&urltrue=/sjkh/depository.htm&&cardId=' + oData.IDNUMBER + '&&clientId=' + oData.CLIENTID + '&&clientName=' + oData.CLIENTNAME + '&&MobileNo=' + oData.MOBILENO + '&&tztcerttype=0&&digitalPwd=123456');					  //onJsOverrideUrlLoading('/sjkh/setpwd.htm'); 					} else {						onJsOverrideUrlLoading('http://action:10053?urlfalse=/sjkh/digital.htm&&urltrue=/sjkh/depository.htm&&cardId=' + oData.IDNUMBER + '&&clientId=' + oData.CLIENTID + '&&clientName=' + oData.CLIENTNAME + '&&MobileNo=' + oData.MOBILENO + '&&tztcerttype=1&&digitalPwd=123456');					}			} else if (open_status[7] == 0) {				onJsOverrideUrlLoading('/sjkh/risk.htm');			} else if (open_status[8] == 0) {				onJsOverrideUrlLoading('/sjkh/visit.htm');			} else if (open_status[8] == 1) {				onJsOverrideUrlLoading('/sjkh/success.htm');			}		} else if (open_status[2] == 3 && oData.csdcOpenFlag == '0') {			onJsOverrideUrlLoading('/sjkh/fail.htm?state=3');		} else if (open_status[2] == 4 && oData.csdcOpenFlag == '0') {			onJsOverrideUrlLoading('/sjkh/fail.htm?state=1');		} else {			alert('开户状态异常，请联系客服人员');		}	});};// 获取状态索引位置(0000000000);0: 未开过户；FALSE：已开过户(已完成所有步骤)：大于0：表示对应跳到这步function getStatusIndex(str) {	alert(str);	var arr = str.split(''),		i = 0,		len = arr.length,		resultIndex = 'false';		for (; i < len; i++) {		if (i == 2) {			if (arr[i] == '2') {				resultIndex = '100';				continue;			} else if (arr[i] == '3') {				resultIndex = '3000';				break;			} else if (arr[i] == '1') {				resultIndex = '1000';				break;			} else {				resultIndex = i;				break;			}		} else {			if (arr[i] == '0') {				resultIndex = i;				break;			}		}	}	return resultIndex;};// 获取验证码function sendMobileCode(succ, fail) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0007&op_station=($tztudid)&mobile_tel=" + $("#sjyzWraper input").eq(0).val());	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			if (binData.placard_md5) { // 有公告				fail();				$('.btnNext').unbind();				$('.btnNext').addClass('btnGray');				getPlacardInfo(binData.placard_md5, function(data){					if (data.info) {						alert(data.info);					} else {						alert('公告内容为空!');					}				});			} else { // 无公告				$('.btnNext').unbind('click');				$('.btnNext').bind('click', clickBtn);				$('.btnNext').removeClass('btnGray');				succ();				alert('短信已发送！');			}		} else {			fail();			alert(error_info);		}	}, {		error: fail	});};// 公告信息获取function getPlacardInfo(md5, succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0047&placard_md5=" + md5);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData);		} else {			alert(error_info);		}	});};// 校验短信验证码function qryRegisterInfo(succ, fail) {	var mobile_tel = $("#sjyzWraper input").eq(0).val();	var params = cRequestSign + encodeURI("?action=31001&path=/WA0015&op_station=($tztudid)&mobile_tel=" + mobile_tel + '&mobile_code=' + $("#sjyzWraper input").eq(1).val() + '&csdc_open_flag=' + oData.csdcOpenFlag);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData, mobile_tel);		} else {			fail();		}	});};// 客户信息查询function qryClientInfo(succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0016&op_station=($tztudid)&client_id=" + oData.CLIENTID);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData);		} else {			alert(error_info);		}	});};// 开户状态查询function qryOpenStatus(client_id, succ) {	var params = cRequestSign + encodeURI("?action=31001&path=/WA0037&op_station=($tztudid)&client_id=" + client_id + "&mobile_tel=" + oData.MOBILENO);	getData(params, '', function (data){		var binData = JSON.parse(data.BINDATA),			error_no = binData.error_no,			error_info = binData.error_info;		if (error_no == '0') {			succ(binData);		} else {			alert(error_info);		}	});};// 获取证书序列号function reqTztcertsn(params, callback) {	getData('/reqlocal', params, function(data) {		callback && callback(data);	});};